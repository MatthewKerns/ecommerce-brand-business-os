{
  "feature": "Amazon SP-API MCF Integration",
  "workflow_type": "feature",
  "workflow_rationale": "Building a new multi-component feature that integrates Amazon Seller Partner API for Multi-Channel Fulfillment. This is a feature workflow because it involves creating authentication, API client, order management, and inventory tracking components that work together as a cohesive system.",
  "phases": [
    {
      "id": "phase-1-setup",
      "name": "Project Setup & Dependencies",
      "type": "setup",
      "description": "Install required dependencies and create project structure for Amazon SP-API integration",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create integrations directory structure",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/integrations/__init__.py",
            "ai-content-agents/integrations/amazon_sp_api/__init__.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "test -d ./ai-content-agents/integrations/amazon_sp_api && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully created integrations directory structure with __init__.py files for integrations/ and integrations/amazon_sp_api/. Verification passed.",
          "updated_at": "2026-02-26T07:07:37.030534+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Add Amazon SP-API Python library to requirements.txt",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/requirements.txt"
          ],
          "files_to_create": [],
          "patterns_from": [
            "ai-content-agents/requirements.txt"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'python-amazon-sp-api' ./ai-content-agents/requirements.txt && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully added python-amazon-sp-api>=1.0.0 to ai-content-agents/requirements.txt. Verification passed.",
          "updated_at": "2026-02-26T07:08:36.278538+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Update .env.example with Amazon SP-API credentials",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/.env.example"
          ],
          "files_to_create": [],
          "patterns_from": [
            "ai-content-agents/.env.example"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'AMAZON_SP_API' ./ai-content-agents/.env.example && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully added Amazon SP-API credentials to ai-content-agents/.env.example including: AMAZON_SELLER_ID, AMAZON_SP_API_CLIENT_ID, AMAZON_SP_API_CLIENT_SECRET, AMAZON_SP_API_REFRESH_TOKEN, AMAZON_SP_API_REGION, and AMAZON_MARKETPLACE_ID with helpful comments and links to documentation. Verification passed.",
          "updated_at": "2026-02-26T07:10:02.810586+00:00"
        }
      ]
    },
    {
      "id": "phase-2-authentication",
      "name": "Amazon SP-API Authentication",
      "type": "implementation",
      "description": "Implement LWA (Login with Amazon) OAuth authentication for SP-API access",
      "depends_on": [
        "phase-1-setup"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Add Amazon SP-API configuration to config.py",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/config/config.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "ai-content-agents/config/config.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from ai_content_agents.config.config import AMAZON_SELLER_ID; print('OK')\" 2>/dev/null || echo 'Check import path'",
            "expected": "OK or configuration variables defined"
          },
          "status": "completed",
          "notes": "Successfully added Amazon SP-API configuration to ai-content-agents/config/config.py. Added 6 configuration variables (AMAZON_SELLER_ID, AMAZON_SP_API_CLIENT_ID, AMAZON_SP_API_CLIENT_SECRET, AMAZON_SP_API_REFRESH_TOKEN, AMAZON_SP_API_REGION, AMAZON_MARKETPLACE_ID) following the existing pattern. Verification passed - all variables are defined and importable.",
          "updated_at": "2026-02-26T07:11:31.114805+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Create Amazon SP-API authentication module",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/integrations/amazon_sp_api/auth.py"
          ],
          "patterns_from": [
            "ai-content-agents/agents/base_agent.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from integrations.amazon_sp_api.auth import get_sp_api_credentials; print('OK')\" 2>/dev/null || test -f ./ai-content-agents/integrations/amazon_sp_api/auth.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully created Amazon SP-API authentication module (auth.py) with LWA OAuth token management. Implemented SPAPIAuth class with token caching, thread-safe token refresh, and convenience functions (get_sp_api_credentials, get_access_token). Follows established code patterns from base_agent.py with proper type hints, docstrings, and error handling. Verification passed - file created and all key components present.",
          "updated_at": "2026-02-26T07:13:40.123257+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Create data models for MCF orders and inventory",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/integrations/amazon_sp_api/models.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "test -f ./ai-content-agents/integrations/amazon_sp_api/models.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully created comprehensive data models for MCF orders and inventory. Implemented dataclasses for Address, MCFOrderItem, MCFFulfillmentOrder, MCFPackage, MCFShipment, and MCFInventoryItem with full type hints, docstrings, and SP-API conversion methods. Includes enums for ShippingSpeedCategory, FulfillmentOrderStatus, and PackageStatus. All models support bidirectional conversion to/from SP-API format. Verification passed.",
          "updated_at": "2026-02-26T07:30:00.000000+00:00"
        }
      ]
    },
    {
      "id": "phase-3-mcf-client",
      "name": "MCF Client Implementation",
      "type": "implementation",
      "description": "Build the core MCF API client for order creation, tracking, and inventory management",
      "depends_on": [
        "phase-2-authentication"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create MCF API client with order creation method",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/integrations/amazon_sp_api/mcf_client.py"
          ],
          "patterns_from": [
            "ai-content-agents/agents/base_agent.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from integrations.amazon_sp_api.mcf_client import MCFClient; print('OK')\" 2>/dev/null || test -f ./ai-content-agents/integrations/amazon_sp_api/mcf_client.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Successfully created comprehensive MCF API client (mcf_client.py) with full order management functionality. Implemented MCFClient class with methods for: order creation (create_fulfillment_order), order retrieval (get_fulfillment_order), order cancellation (cancel_fulfillment_order), package tracking (get_package_tracking_details), order listing (list_all_fulfillment_orders), inventory queries (get_inventory_summaries), and SKU availability checking (check_sku_availability). Follows established code patterns from base_agent.py with proper type hints, comprehensive docstrings, error handling with custom MCFClientError exception, and integration with existing auth and models modules. Uses sp-api Python library for low-level API communication. Verification passed - file created and all key components present. Committed successfully.",
          "updated_at": "2026-02-26T07:35:15.306916+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Implement order tracking retrieval method",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/integrations/amazon_sp_api/mcf_client.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'get_fulfillment_order\\|getPackageTrackingDetails' ./ai-content-agents/integrations/amazon_sp_api/mcf_client.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Order tracking retrieval methods already implemented as part of comprehensive MCF client creation in subtask-3-1. Both get_fulfillment_order() (retrieves order details) and get_package_tracking_details() (retrieves package tracking info) are present and functional. Verification passed - no additional changes needed.",
          "updated_at": "2026-02-26T07:37:33.184195+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Implement inventory level query method",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/integrations/amazon_sp_api/mcf_client.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'inventory\\|get_inventory' ./ai-content-agents/integrations/amazon_sp_api/mcf_client.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4-testing",
      "name": "Testing & Verification",
      "type": "implementation",
      "description": "Create unit tests and integration tests for MCF client functionality",
      "depends_on": [
        "phase-3-mcf-client"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create unit tests for authentication module",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/tests/test_amazon_sp_auth.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "test -f ./ai-content-agents/tests/test_amazon_sp_auth.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-2",
          "description": "Create unit tests for MCF client methods",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/tests/test_mcf_client.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "test -f ./ai-content-agents/tests/test_mcf_client.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-3",
          "description": "Create integration test example script",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/examples/test_mcf_integration.py"
          ],
          "patterns_from": [
            "ai-content-agents/quick_start.py"
          ],
          "verification": {
            "type": "command",
            "command": "test -f ./ai-content-agents/examples/test_mcf_integration.py && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5-documentation",
      "name": "Documentation & Setup Guide",
      "type": "implementation",
      "description": "Create documentation for setting up and using the Amazon SP-API MCF integration",
      "depends_on": [
        "phase-4-testing"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create MCF integration README with setup instructions",
          "service": "ai-content-agents",
          "files_to_modify": [],
          "files_to_create": [
            "ai-content-agents/integrations/amazon_sp_api/README.md"
          ],
          "patterns_from": [
            "ai-content-agents/README.md"
          ],
          "verification": {
            "type": "command",
            "command": "test -f ./ai-content-agents/integrations/amazon_sp_api/README.md && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-2",
          "description": "Update main README with MCF integration section",
          "service": "ai-content-agents",
          "files_to_modify": [
            "ai-content-agents/README.md"
          ],
          "files_to_create": [],
          "patterns_from": [
            "ai-content-agents/README.md"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'MCF\\|Amazon SP-API' ./ai-content-agents/README.md && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 5,
    "total_subtasks": 14,
    "services_involved": [
      "ai-content-agents"
    ],
    "parallelism": {
      "max_parallel_phases": 1,
      "parallel_groups": [],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential execution - each phase depends on the previous",
      "reasoning": "Phases have linear dependencies (setup → auth → client → testing → docs), so parallel execution is not beneficial"
    },
    "startup_command": "cd ai-content-agents && source venv/bin/activate && python -m pytest tests/"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "phase-4-testing",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "Amazon SP-API authentication working with valid credentials",
      "MCF order creation method implemented and tested",
      "Order tracking retrieval functional",
      "Inventory query method working",
      "Unit tests pass for all modules",
      "Integration test example runs without errors",
      "No API credentials hardcoded in source files",
      "All credentials stored in environment variables"
    ],
    "verification_steps": [
      {
        "name": "Unit Tests",
        "command": "cd ai-content-agents && python -m pytest tests/test_amazon_sp_auth.py tests/test_mcf_client.py -v",
        "expected_outcome": "All unit tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Integration Test",
        "command": "cd ai-content-agents && python examples/test_mcf_integration.py",
        "expected_outcome": "Integration test completes without errors (may need valid credentials)",
        "type": "test",
        "required": false,
        "blocking": false
      },
      {
        "name": "Secrets Scan",
        "command": "grep -r 'AKIA\\|aws_secret\\|client_secret' ai-content-agents/integrations/ || echo 'No secrets found'",
        "expected_outcome": "No hardcoded credentials detected",
        "type": "security",
        "required": true,
        "blocking": true
      },
      {
        "name": "Environment Variables Check",
        "command": "grep 'AMAZON_SP_API' ai-content-agents/.env.example | wc -l",
        "expected_outcome": "All required Amazon credentials documented in .env.example",
        "type": "security",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Medium risk API integration requires unit and integration tests plus security scanning to ensure no credentials are hardcoded. No staging deployment needed as this is a library/module integration, not a deployed service."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "cd ai-content-agents && python -m pytest tests/test_amazon_sp_auth.py -v",
        "cd ai-content-agents && python -m pytest tests/test_mcf_client.py -v"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "cd ai-content-agents && python examples/test_mcf_integration.py"
      ],
      "services_to_test": [
        "ai-content-agents"
      ],
      "notes": "Integration tests may require valid Amazon SP-API credentials to run successfully"
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": []
    },
    "browser_verification": {
      "required": false,
      "pages": []
    },
    "api_verification": {
      "required": true,
      "endpoints": [
        {
          "name": "Create MCF Order",
          "description": "MCFClient.create_fulfillment_order() method works",
          "verification": "Unit test validates method exists and handles API response"
        },
        {
          "name": "Get Order Tracking",
          "description": "MCFClient.get_tracking_details() method works",
          "verification": "Unit test validates method exists and parses tracking data"
        },
        {
          "name": "Query Inventory",
          "description": "MCFClient.get_inventory() method works",
          "verification": "Unit test validates method exists and returns inventory data"
        }
      ]
    },
    "security_verification": {
      "required": true,
      "checks": [
        "No hardcoded credentials in source files",
        "All sensitive data loaded from environment variables",
        "Credentials documented in .env.example only"
      ]
    }
  },
  "qa_signoff": null,
  "status": "human_review",
  "planStatus": "review",
  "updated_at": "2026-02-26T07:39:12.823Z",
  "last_updated": "2026-02-26T07:37:33.189093+00:00"
}