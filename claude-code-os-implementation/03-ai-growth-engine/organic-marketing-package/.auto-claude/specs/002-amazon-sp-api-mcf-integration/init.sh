#!/bin/bash

# Amazon SP-API MCF Integration - Environment Setup
# Generated by Planner Agent

set -e

echo "========================================"
echo "Amazon SP-API MCF Integration Setup"
echo "========================================"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# ============================================
# SETUP PYTHON ENVIRONMENT
# ============================================

echo ""
echo "Setting up Python environment..."

# Check if Python 3 is installed
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}Python 3 is not installed. Please install Python 3.8 or higher.${NC}"
    exit 1
fi

# Navigate to ai-content-agents directory
cd ai-content-agents

# Create virtual environment if it doesn't exist
if [ ! -d "venv" ]; then
    echo "Creating virtual environment..."
    python3 -m venv venv
    echo -e "${GREEN}Virtual environment created${NC}"
else
    echo -e "${GREEN}Virtual environment already exists${NC}"
fi

# Activate virtual environment
echo "Activating virtual environment..."
source venv/bin/activate

# Install dependencies
echo "Installing Python dependencies..."
pip install -q --upgrade pip
pip install -q -r requirements.txt

echo -e "${GREEN}Dependencies installed${NC}"

# ============================================
# VERIFY ENVIRONMENT SETUP
# ============================================

echo ""
echo "Verifying environment setup..."

# Check for .env file
if [ ! -f ".env" ]; then
    echo -e "${YELLOW}Warning: .env file not found${NC}"
    echo "Creating .env from .env.example..."
    cp .env.example .env
    echo -e "${YELLOW}Please edit .env and add your API credentials${NC}"
else
    echo -e "${GREEN}.env file exists${NC}"
fi

# Check for required environment variables
if [ -f ".env" ]; then
    source .env

    # Check Anthropic API key
    if [ -z "$ANTHROPIC_API_KEY" ] || [ "$ANTHROPIC_API_KEY" = "your-api-key-here" ]; then
        echo -e "${YELLOW}Warning: ANTHROPIC_API_KEY not set${NC}"
    else
        echo -e "${GREEN}Anthropic API key configured${NC}"
    fi

    # Check Amazon SP-API credentials
    if [ -z "$AMAZON_SP_API_CLIENT_ID" ]; then
        echo -e "${YELLOW}Warning: Amazon SP-API credentials not set${NC}"
        echo "You'll need to configure these before using MCF integration:"
        echo "  - AMAZON_SP_API_CLIENT_ID"
        echo "  - AMAZON_SP_API_CLIENT_SECRET"
        echo "  - AMAZON_SP_API_REFRESH_TOKEN"
        echo "  - AMAZON_SELLER_ID"
        echo "  - AMAZON_MARKETPLACE_ID"
    else
        echo -e "${GREEN}Amazon SP-API credentials configured${NC}"
    fi
fi

# ============================================
# CREATE REQUIRED DIRECTORIES
# ============================================

echo ""
echo "Creating required directories..."

mkdir -p integrations/amazon_sp_api
mkdir -p tests
mkdir -p examples
mkdir -p output/mcf

echo -e "${GREEN}Directories created${NC}"

# ============================================
# SUMMARY
# ============================================

echo ""
echo "========================================"
echo "Environment Ready!"
echo "========================================"
echo ""
echo "Next Steps:"
echo "1. Edit .env file with your API credentials"
echo "2. Run tests: python -m pytest tests/ -v"
echo "3. Check examples: python examples/test_mcf_integration.py"
echo ""
echo "Documentation:"
echo "  - Main README: ./README.md"
echo "  - MCF Integration: ./integrations/amazon_sp_api/README.md"
echo ""
echo "To activate the environment later:"
echo "  source venv/bin/activate"
echo ""
